generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String     @id @default(cuid())
  name          String
  email         String     @unique
  role          String
  walletAddress String?    @unique
  bio           String?
  avatar        String?
  createdAt     DateTime   @default(now())
  proposals     Proposal[]
}

model Grant {
  id               String     @id @default(cuid())
  title            String
  description      String
  amount           Int
  category         String
  deadline         DateTime
  status           String     @default("open")
  donorId          String
  donorName        String
  eligibility      String[]
  requirements     String[]
  milestonesCount  Int
  applicantsCount  Int        @default(0)
  fundsDistributed Int        @default(0)
  createdAt        DateTime   @default(now())
  proposals        Proposal[]
}

model Proposal {
  id              String      @id @default(cuid())
  grantId         String
  grant           Grant       @relation(fields: [grantId], references: [id])
  applicantId     String
  applicant       User        @relation(fields: [applicantId], references: [id])
  applicantName   String
  title           String
  description     String
  requestedAmount Int
  status          String      @default("pending")
  submittedAt     DateTime    @default(now())
  verifierId      String?
  milestones      Milestone[]
}

model Milestone {
  id            String    @id @default(cuid())
  proposalId    String
  proposal      Proposal  @relation(fields: [proposalId], references: [id])
  title         String
  description   String
  amount        Int
  status        String    @default("pending")
  dueDate       DateTime
  submittedAt   DateTime?
  verifiedAt    DateTime?
  verifierNotes String?
  evidence      String?
}

/// Stores the last processed on-chain event version for each event type
model IndexerCursor {
  eventType   String  @id
  lastVersion BigInt  @default(0)
  updatedAt   DateTime @updatedAt
}
